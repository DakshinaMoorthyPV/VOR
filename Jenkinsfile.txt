pipeline {
    agent any 

    triggers {
        // For nightly builds at 2 PM IST (which is 8:30 AM UTC)
        cron('H 30 8 * *')
    }

    environment {
        // Assuming you have MAVEN_HOME configured in Jenkins global tools configuration
        MAVEN_HOME = "${tool name='YOUR_MAVEN_TOOL_NAME'}"
    }

    stages {
        stage('Checkout') {
            steps {
                // This will automatically checkout the code from GitHub
                checkout scm 
            }
        }

        stage('Build and Test') {
            steps {
                // Using Maven to build and test the Selenium project
                sh "${MAVEN_HOME}/bin/mvn clean test"
            }
        }
    }

    post {
        always {
            def recipients = 'dakshina.moorthy@visionetsystem.com, bhuvaneswari.t@visionetsystems.com'
            def ccRecipients = 'dhruvakumar.r@visionet.com'
            def firstNames = recipients.split(',').collect { it.split('@')[0] }.join(', ')
            
            emailext (
                to: recipients,
                cc: ccRecipients,
                subject: "Jenkins Build: ${currentBuild.fullDisplayName}",
                body: """\
                    Hello ${firstNames},

                    Here are the details of the Jenkins build:
                    Build: ${currentBuild.fullDisplayName}
                    Status: ${currentBuild.result}
                    Console Log: ${Jenkins.URL}${currentBuild.url}console
                """,
                mimeType: 'text/plain'
            )
            
            // Send Slack Notification
            slackSend (
                color: currentBuild.result == 'SUCCESS' ? 'good' : 'danger',
                message: "Build: ${currentBuild.fullDisplayName}, Status: ${currentBuild.result}"
            )
        }
        success {
            echo "The build was successful!"
            // Additional steps for successful builds if required
        }
        failure {
            echo "The build failed!"
            // Additional steps for failed builds if required
        }
    }
}
